!! NOTES
!!  This file has been automatically generated by the @SCRIPT@
!!  script. Any change you would bring to it will systematically be
!!  overwritten. See the template file in config/etsf/template.tests.

program tests_init

  use etsf_io_low_level
  use etsf_io
  
  implicit none

  call test_data_init()
  
contains

  subroutine tests_write_status(name, lstat, error)
    character(len = *), intent(in)      :: name
    logical, intent(in)                 :: lstat
    type(etsf_io_low_error), intent(in) :: error
    
    if (lstat) then
      write(*, "(A,A,A,A)") "== ", name, repeat(" ", 68 - len(name)), "OK     =="
    else
      write(*, "(A,A,A,A)") "== ", name, repeat(" ", 68 - len(name)), "Failed =="
      call etsf_io_low_error_handle(error)
    end if
  end subroutine tests_write_status


  subroutine test_data_init()
    type(etsf_dims) :: dims
    integer :: ncid, dimvalue
    type(etsf_io_low_error) :: error
    type(etsf_io_low_var_infos) :: var_infos
    character(len = *), parameter :: me = "test_data_init"
    logical :: lstat

    write(*,*)
    write(*,*) "Testing etsf_io_data_init()..."

    call etsf_io_data_init("test_wrong_0.nc", -1, etsf_grp_none, &
      & dims, "Fichier de test", "history", lstat, error)
    call tests_write_status("main_var: wrong value", (.not. lstat), error)

    call etsf_io_data_init("test_wrong_1.nc", etsf_main_density, -1, &
      & dims, "Fichier de test", "history", lstat, error)
    call tests_write_status("groups: wrong value", (.not. lstat), error)

    call etsf_io_data_init("test_wrong_1.nc", etsf_main_density, etsf_grp_none, &
      & dims, "Fichier de test", "history", lstat, error)
    call tests_write_status("filename: wrong value (file exists)", (.not. lstat), error)


    dims%number_of_grid_points_vector3 = 5
    dims%number_of_symmetries = 4
    dims%max_number_of_coefficients = 6
    dims%max_number_of_projectors = 2
    dims%max_number_of_states = 8
    dims%number_of_atoms = 4
    dims%number_of_kpoints = 12
    dims%number_of_components = 2
@INIT_MAIN@

@INIT_GRP@

    write(*,*)

  end subroutine test_data_init

end program tests_init
